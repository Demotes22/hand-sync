<!DOCTYPE html>
<html>
<head>
    <title>Kirim File</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #111; color: #fff; font-family: sans-serif; text-align: center; margin: 0; }
        video { transform: scaleX(-1); width: 90%; max-width: 400px; border-radius: 10px; margin-top: 10px; border: 2px solid #333; }
        .ui { padding: 20px; background: #222; border-bottom: 2px solid #444; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #st { color: #ffca28; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="ui">
        <h3>PENGIRIM (LAPTOP)</h3>
        <input type="file" id="f"><br><br>
        <button onclick="konek()">HUBUNGKAN KE HP</button>
        <div id="st">Status: Klik Hubungkan</div>
    </div>
    <video id="vid" autoplay playsinline></video>

    <script>
        // ID Pengirim tetap: tangan-laptop
        let peer = new Peer('tangan-laptop'), conn, hold = false;
        const st = document.getElementById('st');

        function konek() {
            st.innerText = "Menghubungkan...";
            // Langsung tembak ke ID HP: tangan-hp
            conn = peer.connect('tangan-hp');
            conn.on('open', () => {
                st.innerText = "TERHUBUNG KE HP! Siap Melempar.";
                st.style.color = "#00ff00";
            });
            conn.on('error', () => st.innerText = "Gagal. Pastikan HP sudah buka halaman.");
        }

        const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
        hands.onResults(res => {
            if (res.multiHandLandmarks[0]) {
                const lm = res.multiHandLandmarks[0];
                const kepal = lm[8].y > lm[6].y && lm[12].y > lm[10].y;
                if (kepal && lm[0].x > 0.7) hold = true;
                if (hold && kepal && lm[0].x < 0.3 && conn && document.getElementById('f').files[0]) {
                    const file = document.getElementById('f').files[0];
                    conn.send({ file: file, name: file.name, type: file.type });
                    st.innerText = "ðŸš€ FILE TERLEMPAR!";
                    hold = false;
                }
            }
        });
        new Camera(document.getElementById('vid'), { onFrame: async () => { await hands.send({image: document.getElementById('vid')}); } }).start();
    </script>
</body>
</html>
